pipeline {
    agent any

    tools {
    maven 'mymaven'
    }

    stages {
        stage ('clone the repository'){
            steps{
                git 'github URL'
            }
         }

         stage ('test the code'){
             steps{
                 sh 'mvn test'
             }
          }

          stage ('Build the image'){
              steps{
                  sh 'docker build -t myapp:${BUILD_NUMBER} .'
              }
           }

           stage ('Deploy the image'){
               steps{
                   sh 'docker run -d -P myapp:${BUILD_NUMBER}'
               }
           }

           stage ('push the imageto dockerhub'){
               steps{
           withCredentials([string(crendetialsId: 'DOCKER_HUB_PASWD', variable: 'DOCKER_HUB_PASWD')])
                  {
                  sh 'docker login -u srinath7019 -p ${DOCKER_HUB_PASWD}'
                 }
                   sh 'docker tag myapp:${BUILD_NUMBER} srinath7019/myapp:${BUILD_NUMBER}'
                   sh 'docker push srinath7019/myapp:${BUILD_NUMBER}'
                }
            }
       }
}
               
                
    
